<!doctype html><html lang=en-us><head><head><br><br><title>From Mammoth to Graham</title><style>html body{font-family:,sans-serif;background-color:#fff}:root{--accent: #2196F3;--border-width:  0 }</style><link rel=stylesheet href=../../../css/main.css><link rel=stylesheet href=../../../css/perso.css><link rel=stylesheet href=../../../css/family.css><link rel=stylesheet href=../../../css/creativecommons.css><link href=https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css rel=stylesheet><link rel=stylesheet href=../../../css/font-awesome.min.css><link rel=stylesheet href=../../../css/academicons.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=../../../js/jquery-ui-1.9.1.custom.min.js></script><script src=../../../js/jquery.tocify.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//bash.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//julia.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//xml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//tex.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//shell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages//matlab.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/tomorrow-night-eighties.min.css><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: false,
    }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/latest.js?config=TeX-MML-AM_CHTML" async></script><link rel=stylesheet href=https://unpkg.com/leaflet@1.5.1/dist/leaflet.css integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin><script src=https://unpkg.com/leaflet@1.5.1/dist/leaflet.js integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin></script><meta name=generator content="Hugo 0.57.2"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"></head></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav mr-auto"><li><a href=../../../publications/>Publications</a></li><li><a href=../../../talks/>Talks&amp;Posters</a></li><li><a href=../../../teaching/>Teaching</a></li><li><a href=../../../software/>Software</a></li><li><a href=../../../econotes/>EcoNotes</a></li><li><a href=../../../notes/>SilicoNotes</a></li><li><a href=../../../perso/>Perso</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=../../../><i class="fa fa-home"></i></a></li><li class=navbar-icon><a href=https://insileco.github.io/><i class="fa fa-external-link-square"></i></a></li><li class=navbar-icon><a href=https://github.com/KevCaz/KevCaz.github.io><i class="fa fa-github"></i></a></li></ul></ul></div></div></nav><br><div class=container><div class=row><div class=col-sm-2><div class="hidden-sm hidden-xs"></div></div><div class=col-sm-10><div class=article-meta><h1><span class=title>From Mammoth to Graham</span></h1><h3><span class=subtitle></span></h3><h3 class=date style=font-size:1.25em>September 19, 2019</h2><p class=tags><i class="fa fa-tags" aria-hidden=true></i>&nbsp;
<a href=../../../tags/compute-canada><kbd class=item-tag>Compute Canada</kbd></a>
<a href=../../../tags/advances-research-computing><kbd class=item-tag>Advances Research Computing</kbd></a>
<a href=../../../tags/high-performance-computing><kbd class=item-tag>High Performance Computing</kbd></a>
<a href=../../../tags/slurm><kbd class=item-tag>Slurm</kbd></a></p><br></div><p><a href=https://www.computecanada.ca/home/ target=_blank>Compute Canada</a> is awesome! Seriously, it is! As explained on its website:</p><blockquote><p>Compute Canada, in partnership with regional organizations ACENET, Calcul Québec, Compute Ontario and WestGrid, leads the acceleration of research and innovation by deploying state-of-the-art advanced research computing (ARC) systems, storage and software solutions. Together we provide essential ARC services and infrastructure for Canadian researchers and their collaborators in all academic and industrial sectors. Our world-class team of more than 200 experts employed by 37 partner universities and research institutions across the country provide direct support to research teams. Compute Canada is a proud ambassador for Canadian excellence in advanced research computing nationally and internationally.<sup class=footnote-ref id=fnref:comcan><a href=#fn:comcan>1</a></sup></p></blockquote><p>A couple of years ago, while I was doing my PhD, I had to run hundreds of models
and some of the simulations took days! I couldn&rsquo;t have done this without Compute
Canada&rsquo;s resources. It was a very positive experience for several reasons:</p><ol><li>Compute Canada&rsquo;s hardware and software are top-notch;</li><li>the documentation is exhaustive and very clear, check out the <a href=https://docs.computecanada.ca/wiki/Compute_Canada_Documentation target=_blank>wiki</a>;</li><li>Compute Canada&rsquo;s staff offers great support;</li><li>I&rsquo;ve learned a lot; </li></ol><p>At that time, I was in Quebec (<a href=https://www.calculquebec.ca/ target=_blank>Calcul Québec</a> was
the regional partner) and had access to Mammoth parallel II (see the <a href=https://wiki.calculquebec.ca/w/Tableau_r%C3%A9sum%C3%A9_des_propri%C3%A9t%C3%A9s_des_serveurs_de_Calcul_Qu%C3%A9bec/fr target=_blank>wiki for
more details about
Mp2</a>)
that was running under CentOS and had
<a href=http://www.adaptivecomputing.com/products/torque/ target=_blank>TORQUE</a> as resource manager.
For the record, below is the bash script I wrote to deploy all my models:</p><pre><code>#!/bin/bash
#PBS -l nodes=94:ppn=1
#PBS -l walltime=12:00:00
#PBS -q qfbb

# import R
module load bioinformatics/R/3.2.5

# Use my working directory
cd $PBS_O_WORKDIR

# record node identity
cat $PBS_NODEFILE &gt; &quot;${PBS_JOBID}.nodes&quot;

parallel -j24 --sshloginfile $PBS_NODEFILE --workdir $PWD Rscript ./myjob.R {1} {2} ::: {1..448} ::: {1..5}
</code></pre><p>The <code>#PBS</code> directives indicate the resources I needed so (see <a href="https://wiki.calculquebec.ca/w/Ex%C3%A9cuter_une_t%C3%A2che/fr#tab=tab7" target=_blank>this page of wiki for more details</a> and then I used <a href=https://www.gnu.org/software/parallel/ target=_blank>GNU Parallel</a> to run my script with the right arguments on the different nodes and the different CPUs.</p><p>Now that I am at the University of Guelph, I have access to <strong>Graham</strong>, that is described on the wiki as follows:</p><blockquote><p>GRAHAM is a heterogeneous cluster, suitable for a variety of workloads, and located at the University of Waterloo. It is named after Wes Graham, the first director of the Computing Centre at Waterloo.</p><p>The parallel filesystem and external persistent storage (NDC-Waterloo) are similar to Cedar&rsquo;s. The interconnect is different and there is a slightly different mix of compute nodes.</p><p>The Graham system is sold and supported by Huawei Canada, Inc. It is entirely liquid cooled, using rear-door heat exchangers.<sup class=footnote-ref id=fnref:graham><a href=#fn:graham>2</a></sup></p></blockquote><p>Graham&rsquo;s OS is also CentOS:</p><pre><code>$ lsb_release -a
LSB Version:	n/a
Distributor ID:	CentOS
Description:	CentOS Linux release 7.5.1804 (Core)
Release:	7.5.1804
Codename:	Core
</code></pre><p>The resource manager installed is
<a href=https://slurm.schedmd.com/quickstart.html target=_blank>Slurm</a> instead of TORQUE, so I had
to use a different script to run my jobs. Before presenting the script I wrote,
I&rsquo;d like to show how I loaded the software I frequently use. Basically, I first
used <code>module spider</code> to identify the module name and the versions available, for
example:</p><pre><code>$ module spider julia

-----------------------------------------------------------------------
  julia:
-----------------------------------------------------------------------
    Description:
      A high-level, high-performance dynamic language for technical
      computing.

     Versions:
        julia/1.0.2
        julia/1.1.0
        julia/1.1.1
        julia/1.2.0
</code></pre><p>Once all the modules I needed were identified, I loaded them all:</p><pre><code>$ module load gcc/7.3.0 geos/3.7.2 gdal/3.0.1 proj/6.0.0 julia/1.1.1 \
    nixpkgs/16.09 python/3.7.4 r/3.6.0 udunits/2.2.26
</code></pre><p>and then saved them so that next time so I don&rsquo;t have to reload them next times I log in.</p><pre><code>$ module save
</code></pre><p>Two other command are pretty useful:
1. <code>module list</code> list loaded modules
2. <code>module unload</code> that unload a loaded module.</p><p>That being done, and after installing specific R packages, I read the wiki page
<a href=https://docs.computecanada.ca/wiki/Running_jobs#Accounts_and_projects target=_blank>&ldquo;Running
jobs&rdquo;</a> to write the following bash script (<code>launch.sh</code>):</p><pre><code>#!/bin/bash
#SBATCH --time=48:00:00
#SBATCH --nodes=1
#SBATCH --account=def-someone
#SBATCH --array=1-12

# Use my working directory
cd $SLURM_SUBMIT_DIR

# Run my job
Rscript ./launcher.R $SLURM_ARRAY_TASK_ID
</code></pre><p>And then typed <code>sbatch launch.sh</code> to send the job to the scheduler. Note that
<code>squeue -u username</code> allows one to monitor his job(s). Worked like a charm
😄! The <code>#SBATCH</code> directives describe the resource required and
<code>$SLURM_ARRAY_TASK_ID</code> distributes 1, 2, &hellip;, 12 to different jobs so that I
have a unique value per CPU, value that is the input of R script <code>launcher.R</code>
that determines which simulation will be run. A day of computation and it was
done!</p><p>To conclude this note, I&rsquo;d like to mention a very helpful table that presents
the main commands for the different resource managers used on the servers of
Compute Canada : <a href=https://slurm.schedmd.com/rosetta.pdf target=_blank>https://slurm.schedmd.com/rosetta.pdf</a>. I found it very useful as I had some knowledge about TORQUE but not Slurm. Also, I&rsquo;d like to point
the reader to the following wiki page <a href=https://docs.computecanada.ca/wiki/R target=_blank>https://docs.computecanada.ca/wiki/R</a> that
explains how to run parallel jobs for R users.</p><div class=footnotes><hr><ol><li id=fn:comcan><a href=https://www.computecanada.ca/about/ target=_blank>https://www.computecanada.ca/about/</a>
<a class=footnote-return href=#fnref:comcan><sup>^</sup></a></li><li id=fn:graham><a href=https://docs.computecanada.ca/wiki/Graham target=_blank>https://docs.computecanada.ca/wiki/Graham</a>
<a class=footnote-return href=#fnref:graham><sup>^</sup></a></li></ol></div></div></div></div><br><br><footer><div class=row><div class=col-sm-3><div class="hidden-sm hidden-xs"></div></div><div class=col-sm-8><div class=row><hr><div class=col-sm-10 style=text-align:center>Personnal website built with <i class="icon ion-md-heart"></i>, <a href=https://gohugo.io/>Hugo</a>
and my <a href=https://github.com/KevCaz/hugo-KevCaz>own theme</a>!
<i class="fa fa-code" aria-hidden=true></i>available on
<a href=https://github.com/KevCaz/KevCaz.github.io><i class="fa fa-github" aria-hidden></i></a>.<br>All content is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/><i class="cc cc-cc-circle cc-1x"></i><i class="cc cc-by-circle cc-1x"></i><i class="cc cc-nc-circle cc-1x"></i><i class="cc cc-sa-circle cc-1x"></i></a>unless otherwise specified.</div><div class=col-sm-2><a href=#><i class="fa fa-arrow-circle-o-up fa-2x" aria-hidden=true></i></a><br><br></div><div></div></div><br></footer></body></html>