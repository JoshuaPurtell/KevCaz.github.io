<!doctype html><html lang=en-us><head><title>KevCaz&#39;s Website</title><link rel=stylesheet href=https://kevcaz.github.io/css/main.min.45a0fb410cb4c2fedb552955d561ef5c7e5c2073b49c6d888256c43144203c75.css media=screen><link rel=stylesheet href=../../../css/perso.css><link rel=stylesheet href=../../../css/family.css></head><body><div class=page><div class=ctn-sidebar-primary><div class=ctt-sidebar-primary><h1>KevCaz&#39;s Website</h1><div class=primary-sidebar-premenu><h2><i class="fas fa-align-center"></i><button onclick="dropDown('p-s-menu')"> Menu</button></h2></div><div class=primary-sidebar-menu id=p-s-menu><h2><a href=../../../><i class="fas fa-home"></i>Home</a></h2><h2><a href=../../../about/><i class="fas fa-id-card"></i>About</a></h2><h2><button onclick="dropDown('dropdown-research')">
<i class="fas fa-microscope"></i>Research</button></h2><div class=dropdown id=dropdown-research><h3><a href=../../../projects/>Projects</a></h3><h3><a href=../../../publications/>Publications</a></h3><h3><a href=../../../software/>Software</a></h3><h3><a href=../../../talks/>Talks &amp; Posters</a></h3><h3><a href=../../../teaching/>Teaching</a></h3><h3><a href=../../../resume/>Resume</a></h3></div><h2 id=current-dropdown><button onclick="dropDown('dropdown-blog')">
<i class="fas fa-blog"></i>Blog</button></h2><div class=dropdown-current id=dropdown-blog><h3><a href=../../../econotes/>EcoNotes</a></h3><h3 id=current><a href=../../../notes/>SilicoNotes</a></h3><h3><a href=https://insileco.github.io/>inSileco</a></h3></div><h2><button onclick="dropDown('dropdown-perso')">
<i class="fas fa-person-booth"></i>Personal stuff</button></h2><div class=dropdown id=dropdown-perso><h3><a href=../../../perso/books>Books I read and liked</a></h3><h3><a href=../../../perso/movies>Movies I watched and liked</a></h3><h3><a href=../../../perso/opinions>Opinions I dare to share</a></h3><h3><a href=../../../perso/famille>Even more personnal</a></h3></div></div><div class=footer><hr id=hr-footer align=left><div class=social-media-banner><a href=https://github.com/KevCaz><i class="fab fab fa-github-square"></i></a><a href=https://twitter.com/KCazelles><i class="fab fa-twitter-square"></i></a><a href=http://orcid.org/0000-0001-6619-9874><i class="ai ai-orcid-square"></i></a><a href="https://scholar.google.ca/citations?user=xzvcu7cAAAAJ%26hl"><i class="ai ai-google-scholar-square"></i></a><a href=https://www.researchgate.net/profile/Kevin_Cazelles><i class="fab fa-researchgate"></i></a></div><div class=footer-custom>Website built with <a href=https://gohugo.io/>Hugo</a>.<br><i class="fas fa-code"></i>available on <a href=https://github.com/KevCaz/KevCaz.github.io><i class="fab fa-github"></i></a>.<br>Content under <a href=https://creativecommons.org/publicdomain/zero/1.0><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-zero"></i></a>unless otherwise specified.</div></div></div></div><div class=ctn-main-content><div class=ctt-main-content><div class=article-meta><h1 id=title>From Mammoth to Graham</h1><h3 class=date>September 19, 2019<div class=tags><i class="fas fa-tags" aria-hidden=true></i>&nbsp;
<a href=../../../tags/compute-canada><kbd class=item-tag>Compute Canada</kbd></a>
<a href=../../../tags/advances-research-computing><kbd class=item-tag>Advances Research Computing</kbd></a>
<a href=../../../tags/high-performance-computing><kbd class=item-tag>High Performance Computing</kbd></a>
<a href=../../../tags/slurm><kbd class=item-tag>Slurm</kbd></a></div><br></div><div class=article-main><p><a href=https://www.computecanada.ca/home/>Compute Canada</a> is awesome! Seriously, it is! As explained on its website:</p><blockquote><p>Compute Canada, in partnership with regional organizations ACENET, Calcul QuÃ©bec, Compute Ontario and WestGrid, leads the acceleration of research and innovation by deploying state-of-the-art advanced research computing (ARC) systems, storage and software solutions. Together we provide essential ARC services and infrastructure for Canadian researchers and their collaborators in all academic and industrial sectors. Our world-class team of more than 200 experts employed by 37 partner universities and research institutions across the country provide direct support to research teams. Compute Canada is a proud ambassador for Canadian excellence in advanced research computing nationally and internationally.<sup class=footnote-ref id=fnref:comcan><a href=#fn:comcan>1</a></sup></p></blockquote><p>A couple of years ago, while I was doing my PhD, I had to run hundreds of models
and some of the simulations took days! I couldn&rsquo;t have done this without Compute
Canada&rsquo;s resources. It was a very positive experience for several reasons:</p><ol><li>Compute Canada&rsquo;s hardware and software are top-notch;</li><li>the documentation is exhaustive and very clear, check out the <a href=https://docs.computecanada.ca/wiki/Compute_Canada_Documentation>wiki</a>;</li><li>Compute Canada&rsquo;s staff offers great support;</li><li>I&rsquo;ve learned a lot;Â </li></ol><p>At that time, I was in Quebec (<a href=https://www.calculquebec.ca/>Calcul QuÃ©bec</a> was
the regional partner) and had access to Mammoth parallel II (see the <a href=https://wiki.calculquebec.ca/w/Tableau_r%C3%A9sum%C3%A9_des_propri%C3%A9t%C3%A9s_des_serveurs_de_Calcul_Qu%C3%A9bec/fr>wiki for
more details about
Mp2</a>)
that was running under CentOS and had
<a href=http://www.adaptivecomputing.com/products/torque/>TORQUE</a> as resource manager.
For the record, below is the bash script I wrote to deploy all my models:</p><pre><code class=language-sh>#!/bin/bash
#PBS -l nodes=94:ppn=1
#PBS -l walltime=12:00:00
#PBS -q qfbb

# import R
module load bioinformatics/R/3.2.5

# Use my working directory
cd $PBS_O_WORKDIR

# record node identity
cat $PBS_NODEFILE &gt; &quot;${PBS_JOBID}.nodes&quot;

parallel -j24 --sshloginfile $PBS_NODEFILE --workdir $PWD Rscript ./myjob.R {1} {2} ::: {1..448} ::: {1..5}
</code></pre><p>The <code>#PBS</code> directives indicate the resources I needed so (see <a href="https://wiki.calculquebec.ca/w/Ex%C3%A9cuter_une_t%C3%A2che/fr#tab=tab7">this page of wiki for more details</a> and then I used <a href=https://www.gnu.org/software/parallel/>GNU Parallel</a> to run my script with the right arguments on the different nodes and the different CPUs.</p><p>Now that I am at the University of Guelph, I have access to <strong>Graham</strong>, that is described on the wiki as follows:</p><blockquote><p>GRAHAM is a heterogeneous cluster, suitable for a variety of workloads, and located at the University of Waterloo. It is named after Wes Graham, the first director of the Computing Centre at Waterloo.</p><p>The parallel filesystem and external persistent storage (NDC-Waterloo) are similar to Cedar&rsquo;s. The interconnect is different and there is a slightly different mix of compute nodes.</p><p>The Graham system is sold and supported by Huawei Canada, Inc. It is entirely liquid cooled, using rear-door heat exchangers.<sup class=footnote-ref id=fnref:graham><a href=#fn:graham>2</a></sup></p></blockquote><p>Graham&rsquo;s OS is also CentOS:</p><pre><code class=language-sh>$ lsb_release -a
LSB Version:	n/a
Distributor ID:	CentOS
Description:	CentOS Linux release 7.5.1804 (Core)
Release:	7.5.1804
Codename:	Core
</code></pre><p>The resource manager installed is
<a href=https://slurm.schedmd.com/quickstart.html>Slurm</a> instead of TORQUE, so I had
to use a different script to run my jobs. Before presenting the script I wrote,
I&rsquo;d like to show how I loaded the software I frequently use. Basically, I first
used <code>module spider</code> to identify the module name and the versions available, for
example:</p><pre><code class=language-sh>$ module spider julia

-----------------------------------------------------------------------
  julia:
-----------------------------------------------------------------------
    Description:
      A high-level, high-performance dynamic language for technical
      computing.

     Versions:
        julia/1.0.2
        julia/1.1.0
        julia/1.1.1
        julia/1.2.0
</code></pre><p>Once all the modules I needed were identified, I loaded them all:</p><pre><code class=language-sh>$ module load gcc/7.3.0 geos/3.7.2 gdal/3.0.1 proj/6.0.0 julia/1.1.1 \
    nixpkgs/16.09 python/3.7.4 r/3.6.0 udunits/2.2.26
</code></pre><p>and then saved them so that next time so I don&rsquo;t have to reload them next times I log in.</p><pre><code class=language-sh>$ module save
</code></pre><p>Two other command are pretty useful:
1. <code>module list</code> list loaded modules
2. <code>module unload</code> that unload a loaded module.</p><p>That being done, and after installing specific R packages, I read the wiki page
<a href=https://docs.computecanada.ca/wiki/Running_jobs#Accounts_and_projects>&ldquo;Running
jobs&rdquo;</a> to write the following bash script (<code>launch.sh</code>):</p><pre><code class=language-sh>#!/bin/bash
#SBATCH --time=48:00:00
#SBATCH --nodes=1
#SBATCH --account=def-someone
#SBATCH --array=1-12

# Use my working directory
cd $SLURM_SUBMIT_DIR

# Run my job
Rscript ./launcher.R $SLURM_ARRAY_TASK_ID
</code></pre><p>And then typed <code>sbatch launch.sh</code> to send the job to the scheduler. Note that
<code>squeue -u username</code> allows one to monitor his job(s). Worked like a charm
ðŸ˜„! The <code>#SBATCH</code> directives describe the resource required and
<code>$SLURM_ARRAY_TASK_ID</code> distributes 1, 2, &hellip;, 12 to different jobs so that I
have a unique value per CPU, value that is the input of R script <code>launcher.R</code>
that determines which simulation will be run. A day of computation and it was
done!</p><p>To conclude this note, I&rsquo;d like to mention a very helpful table that presents
the main commands for the different resource managers used on the servers of
Compute Canada : <a href=https://slurm.schedmd.com/rosetta.pdf>https://slurm.schedmd.com/rosetta.pdf</a>. I found it very useful as I had some knowledge about TORQUE but not Slurm. Also, I&rsquo;d like to point
the reader to the following wiki page <a href=https://docs.computecanada.ca/wiki/R>https://docs.computecanada.ca/wiki/R</a> that
explains how to run parallel jobs for R users.</p><div class=footnotes><hr><ol><li id=fn:comcan><a href=https://www.computecanada.ca/about/>https://www.computecanada.ca/about/</a>
<a class=footnote-return href=#fnref:comcan><sup>^</sup></a></li><li id=fn:graham><a href=https://docs.computecanada.ca/wiki/Graham>https://docs.computecanada.ca/wiki/Graham</a>
<a class=footnote-return href=#fnref:graham><sup>^</sup></a></li></ol></div></div></div><div class=footer2><hr id=hr-footer align=left><div class=social-media-banner><a href=https://github.com/KevCaz><i class="fab fab fa-github-square"></i></a><a href=https://twitter.com/KCazelles><i class="fab fa-twitter-square"></i></a><a href=http://orcid.org/0000-0001-6619-9874><i class="ai ai-orcid-square"></i></a><a href="https://scholar.google.ca/citations?user=xzvcu7cAAAAJ%26hl"><i class="ai ai-google-scholar-square"></i></a><a href=https://www.researchgate.net/profile/Kevin_Cazelles><i class="fab fa-researchgate"></i></a></div><div class=footer-custom>Website built with <a href=https://gohugo.io/>Hugo</a>.<br><i class="fas fa-code"></i>available on <a href=https://github.com/KevCaz/KevCaz.github.io><i class="fab fa-github"></i></a>.<br>Content under <a href=https://creativecommons.org/publicdomain/zero/1.0><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-zero"></i></a>unless otherwise specified.</div></div></div><div class=ctn-sidebar-secondary><div class=ctt-sidebar-secondary><h1><a href=#><i class="far fas fa-chevron-up"></i></a></h1><script src=../../../js/sidebar-secondary.js></script><h1><a onclick=scrollToBottom()><i class="far fas fa-chevron-down"></i></a></h1></div></div></div><script src=../../../js/sidebar-primary-dropdown.js></script><script>scrollingElement=(document.scrollingElement||document.body)
function scrollToBottom(){scrollingElement.scrollTop=scrollingElement.scrollHeight;}</script></body></html>